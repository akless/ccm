(function(){var components={};var db;var resources={};var stores={};var waiter={};var Datastore=function(){var callbacks=[];var that=this;var my;this.init=function(callback){my=self.helper.privatize(that,"source","local","store","url","db","socket","user");that.source=function(){return my.source};if(my.socket)my.socket.onmessage=function(message){message=JSON.parse(message.data);if(message.callback)callbacks[message.callback-1](message.data);else{var dataset=self.helper.isObject(message)?updateLocal(message):delLocal(message);if(that.onchange)that.onchange(dataset)}};if(callback)callback()};this.clear=function(){my.local={}};this.get=function(key_or_query,callback){if(typeof key_or_query==="function"){callback=key_or_query;key_or_query=undefined}if(key_or_query===undefined)key_or_query={};if(my.url)return serverDB();if(my.store)return clientDB();if(my.local)return localCache();function localCache(){return getLocal(key_or_query,callback)}function clientDB(){var dataset=checkLocal();if(dataset)return dataset;var store=getStore();var request=store.get(key_or_query);request.onsuccess=function(evt){if(!callback)return;var dataset=evt.target.result;if(!self.helper.isDataset(dataset))callback(null);setLocal(dataset);if(callback)callback(dataset||null)}}function serverDB(){if(!self.helper.isObject(key_or_query)){var dataset=checkLocal();if(dataset)return dataset}var data=prepareData({key:key_or_query});if(my.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(response){if(self.helper.isDataset(response))setLocal(response);else if(Array.isArray(response))response.map(setLocal);if(callback)callback(response||null)}}function checkLocal(){var dataset=getLocal(key_or_query);if(dataset&&callback)callback(dataset);return dataset}};this.set=function(priodata,callback){priodata=self.helper.clone(priodata);if(!priodata.key)priodata.key=self.helper.generateKey();if(Array.isArray(priodata.key)){for(var i=0;i<priodata.key.length;i++)if(!self.helper.regex("key").test(priodata.key[i])){if(callback)callback(null);return null}}else if(!self.helper.regex("key").test(priodata.key)){if(callback)callback(null);return null}if(my.url)return serverDB();if(my.store)return clientDB();if(my.local)return localCache();function localCache(){return updateLocal(priodata,callback)}function clientDB(){var store=getStore();var request=store.put(priodata);request.onsuccess=localCache}function serverDB(){var data=prepareData({dataset:priodata});if(my.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(dataset){if(!checkResponse(dataset))return;priodata=dataset;localCache()}}};this.del=function(key,callback){if(my.url)return serverDB();if(my.store)return clientDB();if(my.local)return localCache();function localCache(){return delLocal(key,callback)}function clientDB(){var store=getStore();var request=store.delete(key);request.onsuccess=localCache}function serverDB(){var data=prepareData({del:key});if(my.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(dataset){if(!checkResponse(dataset))return;if(callback)callback(dataset);callback=undefined;localCache()}}};function getLocal(key,callback){if(key===undefined||self.helper.isObject(key))return find();var dataset=self.helper.clone(my.local[key])||null;solveDependencies(dataset,callback);return dataset;function find(){var results=[];var counter=1;for(var i in my.local){if(self.helper.isSubset(key,my.local[i])){var dataset=self.helper.clone(my.local[i]);results.push(dataset);counter++;solveDependencies(dataset,check)}}check();return results;function check(){counter--;if(counter===0&&callback)callback(results)}}function solveDependencies(dataset,callback){var counter=1;var waiter=[];search(dataset);check();function search(array_or_object){for(var key in array_or_object){var value=array_or_object[key];if(self.helper.isDependency(value)&&value[0]==="ccm.get")solveDependency(array_or_object,key);else if(Array.isArray(value)||self.helper.isObject(value))search(value)}}function solveDependency(dataset,key){if(stores[getSource(dataset[key][1])]===null)return waiter.push([solveDependency,dataset,key]);counter++;self.helper.solveDependency(dataset,key,check)}function check(){counter--;if(counter!==0)return;if(waiter.length>0)return self.helper.action(waiter.pop());if(callback)callback(dataset)}}}function setLocal(dataset){if(dataset.key)my.local[dataset.key]=dataset}function updateLocal(priodata,callback){if(my.local[priodata.key])self.helper.integrate(priodata,my.local[priodata.key]);else my.local[priodata.key]=priodata;return getLocal(priodata.key,callback)}function delLocal(key,callback){var dataset;if(key===undefined){dataset=my.local;my.local={}}else{dataset=my.local[key];delete my.local[key]}if(callback)callback(dataset);return dataset}function getStore(){var trans=db.transaction([my.store],"readwrite");return trans.objectStore(my.store)}function prepareData(data){data=self.helper.integrate(data,{db:my.db,store:my.store});if(!my.db)delete data.db;if(my.user&&my.user.isLoggedIn())data=self.helper.integrate(data,{user:my.user.data().user,token:my.user.data().token});return data}function useWebsocket(data,callback){callbacks.push(callback);data.callback=callbacks.length;my.socket.send(JSON.stringify(data))}function useHttp(data,callback){self.load({url:my.url,params:data},callback)}function checkResponse(response){if(typeof response==="string"){return false}return true}};if(!window.ccm)ccm={components:{},callbacks:{},files:{}};var self={version:function(){return"10.0.0"},clear:function(){resources={};stores={}},load:function(){var counter=1;var results=[];var args=self.helper.makeIterable(arguments);var call=args.slice(0);call.unshift(self.load);var waiting=false;var callback;if(typeof args[args.length-1]==="function")callback=args.pop();args.map(loadResource);return check();function loadResource(resource,i){counter++;if(Array.isArray(resource)){results[i]=[];return serial(null)}if(!self.helper.isObject(resource))resource={url:resource};if(resource.context)resource.ignore_cache=true;if(resource.params)resource.ignore_cache=true;if(!resource.context||resource.context==="head")resource.context=document.head;if(caching())return;resources[resource.url]=null;if(resource.params)return exchangeData();var suffix=resource.url.split(".").pop();switch(suffix){case"html":return loadHTML();case"css":return loadCSS();case"jpg":case"gif":case"png":case"svg":return loadImage();case"js":return loadJS();case"json":return loadJSON();default:exchangeData()}function serial(result){if(result!==null)results[i].push(result);if(resource.length>0){var next=resource.shift();if(Array.isArray(next)){next.push(serial);self.load.apply(null,next)}else self.load(next,serial)}else check()}function caching(){if(resource.ignore_cache)return false;if(resources[resource.url]===null){if(waiting)return true;waiting=true;if(!waiter[resource.url])waiter[resource.url]=[];waiter[resource.url].push(call);return true}if(resources[resource.url]!==undefined){results[i]=resources[resource.url];success();return true}return false}function loadHTML(){ajax({url:resource.url,type:"html",callback:successData})}function loadCSS(){var tag={tag:"link",rel:"stylesheet",type:"text/css",href:resource.url};if(resource.attr)self.helper.integrate(resource.attr,tag);tag=self.helper.html(tag);resource.context.appendChild(tag);tag.onload=success}function loadImage(){var image=new Image;image.src=resource.url;image.onload=success}function loadJS(){var filename=resource.url.split("/").pop().replace(".min.",".");ccm.files[filename]=null;var tag={tag:"script",src:resource.url};if(resource.attr)self.helper.integrate(resource.attr,tag);tag=self.helper.html(tag);resource.context.appendChild(tag);tag.onload=function(){results[i]=resources[resource.url]=ccm.files[filename];delete ccm.files[filename];success()}}function loadJSON(){ajax({url:resource.url,type:"json",callback:function(result){successData(JSON.parse(result))}})}function exchangeData(){if(waiting)return;if(resource.url.indexOf("http")===0)return jsonp();var settings={url:resource.url,data:resource.params,callback:successData};if(resource.username&&resource.password){if(resource.username)settings.username=resource.username;if(resource.password)settings.password=resource.password}ajax(settings);function jsonp(){var callback="callback"+self.helper.generateKey();if(!resource.params)resource.params={};resource.params.callback="ccm.callbacks."+callback;ccm.callbacks[callback]=function(data){resource.context.removeChild(tag);delete ccm.callbacks[callback];successData(data)};var tag={tag:"script",src:buildURL(resource.url,resource.params)};if(resource.attr)self.helper.integrate(resource.attr,tag);tag=self.helper.html(tag);tag.src=tag.src.replace(/&amp;/g,"&");resource.context.appendChild(tag)}}function ajax(settings){switch(settings.type){case"html":settings.type="text/html";break;case"json":settings.type="application/javascript";break}settings.async=settings.async===undefined?true:!!settings.async;var request=new XMLHttpRequest;request.open("GET",buildURL(settings.url,settings.data),!!settings.async,settings.username,settings.password);if(settings.type)request.setRequestHeader("Content-type",settings.type);request.onreadystatechange=function(){if(request.readyState==4&&request.status==200)settings.callback(request.responseText)};request.send()}function buildURL(url,data){return data?url+"?"+params(data).slice(0,-1):url;function params(obj,prefix){var result="";for(var i in obj){var key=prefix?prefix+"["+encodeURIComponent(i)+"]":encodeURIComponent(i);if(typeof obj[i]==="object")result+=params(obj[i],key);else result+=key+"="+encodeURIComponent(obj[i])+"&"}return result}}function successData(data){results[i]=resources[resource.url]=data;success()}function success(){if(results[i]===undefined)results[i]=resources[resource.url]=resource.url;while(waiter[resource.url]&&waiter[resource.url].length>0)self.helper.action(waiter[resource.url].pop());check()}}function check(){counter--;if(counter===0){if(results.length<=1)results=results[0];if(callback)callback(results);return results}}},component:function(component,config,callback){if(typeof config==="function"){callback=config;config=undefined}if(typeof component==="string"){if(component.indexOf(".js")===-1)return proceed(components[component]);else{var index=self.helper.getIndex(component);if(components[index])return proceed(components[index]);else self.load(component,proceed)}}else return proceed(component);function proceed(component){if(!self.helper.isObject(component))return;setNameVersionIndex();if(components[component.index])return finish();components[component.index]=component;ccm.components[component.index]={};if(!("registerElement"in document))self.load(["https://cdnjs.cloudflare.com/ajax/libs/document-register-element/0.5.3/document-register-element.js","https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.22/webcomponents-lite.min.js"],proceed);else return proceed();function proceed(){setup();defineCustomElement();if(component.init){component.init(finish);delete component.init}else return finish();function setup(){component.instances=0;component.ccm=self;component.instance=function(config,callback){return self.instance(component.index,config,callback)};component.start=function(config,callback){return self.start(component.index,config,callback)};if(!component.config)component.config={};component.config.ccm=self}function defineCustomElement(){var name="ccm-"+component.index;if(document.createElement(name).constructor!==HTMLElement)return;var tag=Object.create(HTMLElement.prototype);tag.attachedCallback=function(){if(!document.body.contains(this))return;var node=this;while(node=node.parentNode)if(node.tagName&&node.tagName.indexOf("CCM-")===0)return;var config=self.helper.generateConfig(this);config.root=this;component.start(config)};document.registerElement("ccm-"+component.index,{prototype:tag})}}function setNameVersionIndex(){if(component.index){var array=component.index.split("-");component.name=array.shift();if(array.length>0)component.version=array}component.index=component.name;if(component.version)component.index+="-"+component.version.join("-")}function finish(){component=self.helper.clone(components[component.index]);if(config){if(self.helper.isElementNode(config))config={root:config};component.config=self.helper.integrate(self.helper.clone(config),component.config);closure(component)}if(callback)callback(component);return component;function closure(component){component.instance=function(config,callback){return perform(self.instance,config,callback)};component.start=function(config,callback){return perform(self.start,config,callback)};function perform(method,config,callback){if(typeof config==="function"){callback=config;config=undefined}if(self.helper.isElementNode(config))config={root:config};config=self.helper.integrate(config,self.helper.clone(component.config));return method(component.index,config,function(instance){instance.component=component;if(callback)callback(instance)})}}}}},instance:function(component,config,callback){if(typeof config==="function"){callback=config;config=undefined}var counter=0;var result;var waiter=[];return recursive(component,config);function recursive(comp,cfg,prev_cfg,prev_key,parent){counter++;var async=false;var comp=self.component(comp,function(comp){if(async)proceed(comp.index)});if(comp)return proceed(comp.index);async=true;function proceed(index){if(self.helper.isDependency(cfg))cfg={key:cfg};if(cfg&&cfg.key){if(self.helper.isObject(cfg.key))return integrate(self.helper.clone(cfg.key));else if(self.helper.isDependency(cfg.key))return cfg.key[0]==="ccm.load"?self.load(cfg.key[1],integrate):self.get(cfg.key[1],cfg.key[2],integrate);else proceed(cfg)}else return proceed(cfg);function integrate(dataset){self.helper.integrate(cfg,dataset);delete dataset.key;return proceed(dataset)}function proceed(cfg){if(!document.head.attachShadow&&!document.head.createShadowRoot){if(ccm.shady)return self.helper.wait(1e3,proceed);ccm.shady=true;self.load("https://kaul.inf.h-brs.de/ccm/lib/shadydom.min.js",function(){delete ccm.shady;proceed()})}else return proceed();function proceed(){if(self.helper.isElementNode(cfg))cfg={root:cfg};var instance=new components[index].Instance;components[index].instances++;if(prev_cfg)prev_cfg[prev_key]=instance;if(parent)instance.parent=parent;if(!result)result=instance;self.helper.integrate(self.helper.clone(components[index].config),instance);if(cfg){self.helper.privatize(cfg,"ccm","component","element","id","index","init","key","ready","start");self.helper.integrate(cfg,instance)}instance.id=components[index].instances;instance.index=index+"-"+instance.id;instance.component=components[index];setElement();solveDependencies(instance);return check();function setElement(){if(instance.root==="parent"){instance.root=instance.parent.root;instance.element=instance.parent.element;return}if(instance.root==="name")instance.root=instance.parent.element.querySelector("#"+instance.component.name);if(!instance.root)instance.root=document.createElement("div");if(!instance.root.parentNode)document.head.appendChild(instance.root);var element=self.helper.html({id:"element"});var shadow=instance.root.attachShadow({mode:"open"});shadow.appendChild(element);instance.element=element}function solveDependencies(instance_or_array){for(var key in instance_or_array){var value=instance_or_array[key];if(self.helper.isDependency(value))solveDependency(instance_or_array,key);else if(typeof value==="object"&&value!==null){if(self.helper.isNode(value)||self.helper.isInstance(value)||self.helper.isComponent(value))continue;solveDependencies(value)}}function solveDependency(instance_or_array,key){var action=instance_or_array[key];switch(action[0]){case"ccm.load":counter++;action.shift();setContext(action);action.push(setResult);self.load.apply(null,action);break;case"ccm.component":counter++;if(!action[2])action[2]={};action[2].parent=instance;self.component(action[1],action[2],function(result){setResult(result)});break;case"ccm.instance":waiter.push([recursive,action[1],action[2],instance_or_array,key,instance]);break;case"ccm.proxy":proxy(action[1],action[2],instance_or_array,key,instance);break;case"ccm.store":counter++;if(!action[1])action[1]={};action[1].delayed=true;self.store(action[1],setResult);break;case"ccm.get":counter++;self.get(action[1],action[2],setResult);break;case"ccm.set":counter++;self.set(action[1],action[2],setResult);break;case"ccm.del":counter++;self.del(action[1],action[2],setResult);break}function setContext(resources){for(var i=0;i<resources.length;i++){if(Array.isArray(resources[i]))return setContext(resources[i]);if(!self.helper.isObject(resources[i]))resources[i]={url:resources[i]};if(!resources[i].context)resources[i].context=instance.element.parentNode}}function setResult(result){instance_or_array[key]=result;check()}function proxy(component,config,instance_or_array,key,parent){self.helper.isDependency(config)?self.get(config[1],config[2],proceed):proceed(config);function proceed(config){instance_or_array[key]={component:component,parent:parent,start:function(callback){delete this.component;delete this.start;if(!config)config={};self.helper.integrate(this,config);self.start(component,config,function(instance){instance_or_array[key]=instance;if(callback)callback()})}}}}}}function check(){counter--;if(counter===0){if(waiter.length>0)return self.helper.action(waiter.shift());initialize(result,function(){if(result.root.parentNode===document.head)document.head.removeChild(result.root);if(callback)callback(result)})}return counter===0?result:null}function initialize(instance,callback){var results=[instance];find(instance);var i=0;init();function find(obj){var inner=[];for(var key in obj){var value=obj[key];if(self.helper.isInstance(value)&&key!=="parent"&&!self.helper.isProxy(value))inner.push(value);else if(Array.isArray(value)||self.helper.isObject(value)){if(self.helper.isNode(value)||self.helper.isComponent(value)||self.helper.isInstance(value))continue;inner.push(value)}}inner.map(function(obj){if(self.helper.isInstance(obj)||self.helper.isDatastore(obj))results.push(obj)});inner.map(function(obj){find(obj)})}function init(){if(i===results.length)return ready();var obj=results[i];i++;if(obj.init)obj.init(function(){delete obj.init;init()});else init()}function ready(){if(results.length===0)return callback();var obj=results.pop();delete obj.init;if(obj.ready){var tmp=obj.ready;delete obj.ready;tmp(ready)}else ready()}}}}}}},start:function(component,config,callback){if(typeof config==="function"){callback=config;config=undefined}self.instance(component,config,function(instance){instance.start(function(){if(callback)callback(instance)})})},store:function(settings,callback){if(typeof settings==="function"){callback=settings;settings=undefined}if(!settings)settings={};if(typeof settings==="string"||self.helper.isObject(settings)&&!settings.local&&!settings.store&&!settings.url&&!settings.delayed&&!settings.user)settings={local:settings};settings=self.helper.clone(settings);var source=getSource(settings);if(stores[source]){if(callback)callback(stores[source]);return stores[source]}if(!settings.source)settings.source=source;if(!settings.local)settings.local={};if(typeof settings.local==="string")self.load(settings.local,proceed);else return proceed(settings.local);function proceed(datasets){settings.local=datasets;return settings.store&&!settings.url?prepareDB(proceed):proceed();function prepareDB(callback){!db?openDB(proceed):proceed();function openDB(callback){var request=indexedDB.open("ccm");request.onsuccess=function(){db=this.result;callback()}}function proceed(){!db.objectStoreNames.contains(settings.store)?updateDB(callback):callback();function updateDB(callback){var version=parseInt(localStorage.getItem("ccm"));if(!version)version=1;db.close();var request=indexedDB.open("ccm",version+1);request.onupgradeneeded=function(){db=this.result;localStorage.setItem("ccm",db.version);db.createObjectStore(settings.store,{keyPath:"key"})};request.onsuccess=callback}}}function proceed(){var store=new Datastore;self.helper.integrate(settings,store);if(store.url&&store.url.indexOf("ws")===0){var message=[store.db,store.store];if(store.datasets)message=message.concat(store.datasets);store.socket=new WebSocket(store.url,"ccm");store.socket.onopen=function(){this.send(message);proceed()}}else return proceed();function proceed(){delete store.datasets;if(!store.delayed){store.init();delete store.init}else delete store.delayed;stores[source]=store;if(callback)callback(store);return store}}}},get:function(settings,key_or_query,callback){self.store(settings,function(store){var property;if(typeof key_or_query==="string"){property=key_or_query.split(".");key_or_query=property.shift();property=property.join(".")}store.get(key_or_query,function(result){callback(property?self.helper.deepValue(result,property):result)})})},set:function(settings,priodata,callback){self.store(settings,function(store){store.set(priodata,callback)})},del:function(settings,key,callback){self.store(settings,function(store){store.del(key,callback)})},context:{find:function(instance,property){var start=instance;while(instance=instance.parent)if(instance[property]&&instance[property]!==start)return instance[property]},root:function(instance){while(instance.parent)instance=instance.parent;return instance}},helper:{action:function(action,context){if(typeof action==="function")return action();if(typeof action!=="object")action=action.split(" ");if(typeof action[0]==="function")return action[0].apply(window,action.slice(1));else if(action[0].indexOf("this.")===0)return this.executeByName(action[0].substr(5),action.slice(1),context);else return this.executeByName(action[0],action.slice(1))},append:function(parent,node){node=self.helper.protect(node);parent.appendChild(node)},clone:function(value){return recursive(value);function recursive(value){if(self.helper.isNode(value)||self.helper.isInstance(value))return value;if(Array.isArray(value)||self.helper.isObject(value)){var copy=Array.isArray(value)?[]:{};for(var i in value)copy[i]=recursive(value[i]);return copy}return value}},compareVersions:function(a,b){if(a===b)return 0;if(!a||a==="latest")return 1;if(!b||b==="latest")return-1;var a=a.split(".");var b=b.split(".");var x,y;for(var i=0;i<3;i++){x=parseInt(a[i]);y=parseInt(b[i]);if(x<y)return-1;else if(x>y)return 1}return 0},convertObjectKeys:function(obj){var keys=Object.keys(obj);keys.map(function(key){if(key.indexOf(".")!==-1){self.helper.deepValue(obj,key,obj[key]);delete obj[key]}});return obj},dataset:function(store,key,callback){if(typeof key==="function"){callback=key;if(store.store){key=store.key;store=store.store}else return callback(store)}if(!key)key=self.helper.generateKey();store.get(key,function(dataset){callback(dataset===null?{key:key}:dataset)})},decodeDependencies:function(obj){for(var key in obj)if(typeof obj[key]==="string"&&/^\[\W*ccm\.\w+.*\]$/.test(obj[key]))obj[key]=JSON.parse(obj[key].replace(/'/g,'"'))},deepValue:function(obj,key,value){return recursive(obj,key.split("."),value);function recursive(obj,key,value){if(!obj)return;var next=key.shift();if(key.length===0)return value!==undefined?obj[next]=value:obj[next];if(!obj[next]&&value!==undefined)obj[next]={};return recursive(obj[next],key,value)}},encodeDependencies:function(obj){for(var key in obj)if(self.helper.isDependency(obj[key]))obj[key]=JSON.stringify(obj[key]).replace(/"/g,"'")},executeByName:function(functionName,args,context){if(!context)context=window;var namespaces=functionName.split(".");functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[functionName].apply(context,args)},filterProperties:function(obj,properties){var result={};properties=self.helper.makeIterable(arguments);properties.shift();properties.map(function(property){result[property]=obj[property]});return result},format:function(string,values){var functions=[[],[]];string=JSON.stringify(string,function(key,val){if(typeof val==="function"){functions[0].push(val);return"%f0%"}return val});for(var i=1;i<arguments.length;i++){if(typeof arguments[i]==="function"){functions[1].push(arguments[i]);arguments[i]="%f1%"}if(typeof arguments[i]==="object")for(var key in arguments[i]){if(typeof arguments[i][key]==="function"){functions[1].push(arguments[i][key]);arguments[i][key]="%f1%"}if(typeof arguments[i][key]==="string")arguments[i][key]=escape(arguments[i][key]);string=string.replace(new RegExp("%"+key+"%","g"),arguments[i][key])}else{if(typeof arguments[i]==="string")arguments[i]=escape(arguments[i]);string=string.replace(/%%/,arguments[i])}}return JSON.parse(string,function(key,val){if(val==="%f0%")return functions[0].shift();if(val==="%f1%")return functions[1].shift();return val});function escape(string){return string.replace(/"/g,"'").replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f")}},formData:function(form){var data={};self.helper.makeIterable(form.querySelectorAll("*[name]")).map(function(input){if(input.getAttribute("type")==="radio"){if(input.checked)data[input.getAttribute("name")]=input.value}else if(input.getAttribute("type")==="checkbox")data[input.getAttribute("name")]=input.checked?input.value==="on"?true:input.value:"";else if(input.getAttribute("type")==="number"){var value=parseInt(input.value);if(isNaN(value))value="";data[input.getAttribute("name")]=value}else if(!input.value)data[input.getAttribute("name")]="";else data[input.getAttribute("name")]=input.value});return data},generateConfig:function(node){var config={};catchAttributes(node,config);catchInnerTags(node);return config;function catchAttributes(node,obj){self.helper.makeIterable(node.attributes).map(function(attr){if(attr.name!=="src"||node.tagName.indexOf("CCM-COMPONENT")!==0&&node.tagName.indexOf("CCM-INSTANCE")!==0&&node.tagName.indexOf("CCM-PROXY")!==0)try{self.helper.deepValue(obj,attr.name,attr.value.charAt(0)==="{"||attr.value.charAt(0)==="["?JSON.parse(attr.value):prepareValue(attr.value))}catch(err){}})}function catchInnerTags(node){config.childNodes=[];self.helper.makeIterable(node.childNodes).map(function(child){if(child.tagName&&child.tagName.indexOf("CCM-")===0){var split=child.tagName.toLowerCase().split("-");if(split.length<3)split[2]=split[1];switch(split[1]){case"load":self.helper.deepValue(config,split[2],interpretLoadTag(child,split[2]));break;case"component":case"instance":case"proxy":self.helper.deepValue(config,split[2],["ccm."+split[1],child.getAttribute("src")||split[2],self.helper.generateConfig(child)]);break;case"store":case"get":var settings={};catchAttributes(child,settings);var key=settings.key;delete settings.key;self.helper.deepValue(config,split[2],["ccm."+split[1],settings,key]);break;case"list":var list=null;self.helper.makeIterable(child.children).map(function(entry){if(entry.tagName&&entry.tagName.indexOf("CCM-ENTRY")===0){var value=prepareValue(entry.getAttribute("value"));var split=entry.tagName.toLowerCase().split("-");if(!list)list=split.length<3?[]:{};if(split.length<3)list.push(value);else self.helper.deepValue(list,split[2],value)}});if(!list)list={};catchAttributes(child,list);if(list)self.helper.deepValue(config,split[2],list);break;default:config.childNodes.push(child);node.removeChild(child)}}else{config.childNodes.push(child);node.removeChild(child)}});config.inner=self.helper.html({});config.childNodes.map(function(child){config.inner.appendChild(child)});delete config.childNodes;if(!config.inner.hasChildNodes())delete config.inner;function interpretLoadTag(node){var params=generateParameters(node);if(!Array.isArray(params))params=[params];params.unshift("ccm.load");if(node.hasAttribute("head"))params.push(true);return params;function generateParameters(node){if(node.hasAttribute("src")){if(node.children.length===0)return node.getAttribute("src");var data={};self.helper.makeIterable(node.children).map(function(child){if(child.tagName&&child.tagName.indexOf("CCM-DATA-")===0)data[child.tagName.toLowerCase().split("-")[2]]=child.getAttribute("value")});return[node.getAttribute("src"),data]}var params=[];self.helper.makeIterable(node.children).map(function(child){if(child.tagName==="CCM-SERIAL"&&(node.tagName==="CCM-PARALLEL"||node.tagName.indexOf("CCM-LOAD")===0)||child.tagName==="CCM-PARALLEL"&&node.tagName==="CCM-SERIAL")params.push(generateParameters(child))});return params}}}function prepareValue(value){if(value==="true")return true;if(value==="false")return false;if(value==="null")return null;if(value==="undefined")return undefined;if(value==="")return"";if(!isNaN(value))return parseInt(value);return value}},generateKey:function(){return Date.now()+"X"+Math.random().toString().substr(2)},getElementID:function(instance){return"ccm-"+instance.index},getIndex:function(url){if(url.indexOf(".js")===-1)return url;var filename=url.split("/").pop();if(!self.helper.regex("filename").test(filename))return"";var split=filename.split(".");if(split[0]==="ccm")split.shift();split.pop();if(split[split.length-1]==="min")split.pop();return split.join("-")},hide:function(instance){instance.element.parentNode.appendChild(self.helper.loading(instance));instance.element.style.display="none"},html:function(html,values){if(self.helper.isNode(html))return html;html=self.helper.clone(html);if(arguments.length>1)html=self.helper.format.apply(this,arguments);if(Array.isArray(html)){var result=[];for(var i=0;i<html.length;i++)result.push(self.helper.html(html[i]));return result}if(typeof html!=="object")return html;var element=document.createElement(self.helper.htmlEncode(html.tag||"div"));delete html.tag;delete html.key;for(var key in html){var value=html[key];switch(key){case"async":case"autofocus":case"checked":case"defer":case"disabled":case"ismap":case"multiple":case"readonly":case"required":case"selected":if(value)element[key]=true;break;case"inner":if(typeof value==="string"||typeof value==="number"){element.innerHTML=value;break}var children=this.html(value);if(!Array.isArray(children))children=[children];for(var i=0;i<children.length;i++)if(self.helper.isElementNode(children[i]))element.appendChild(children[i]);else element.innerHTML+=children[i];break;default:if(key.indexOf("on")===0&&typeof value==="function")element.addEventListener(key.substr(2),value);else element.setAttribute(key,self.helper.htmlEncode(value))}}return self.helper.protect(element)},htmlEncode:function(value,trim,quot){if(typeof value!=="string")value=value.toString();value=trim||trim===undefined?value.trim():value;value=document.createElement("a").appendChild(document.createTextNode(value)).parentNode.innerHTML;value=quot||quot===undefined?value.replace(/"/g,"&quot;"):value;return value},integrate:function(priodata,dataset,as_defaults){if(!priodata)return dataset;if(!dataset)return priodata;for(var key in priodata){if(!as_defaults||self.helper.deepValue(dataset,key)===undefined)self.helper.deepValue(dataset,key,priodata[key])}return dataset},isComponent:function(value){return self.helper.isObject(value)&&value.Instance&&true},isDataset:function(value){return self.helper.isObject(value)},isDatastore:function(value){return self.helper.isObject(value)&&value.get&&value.set&&value.del&&true},isDependency:function(value){if(Array.isArray(value))if(value.length>0)switch(value[0]){case"ccm.load":case"ccm.component":case"ccm.instance":case"ccm.proxy":case"ccm.start":case"ccm.store":case"ccm.get":case"ccm.set":case"ccm.del":return true}return false},isElementNode:function(value){return value instanceof Element},isFirefox:function(){return navigator.userAgent.search("Firefox")>-1},isGoogleChrome:function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},isInstance:function(value){return self.helper.isObject(value)&&value.component&&true},isNode:function(value){return value instanceof Node;

},isObject:function(value){return typeof value==="object"&&value!==null&&!Array.isArray(value)},isProxy:function(value){return self.helper.isInstance(value)&&typeof value.component==="string"},isSubset:function(obj,other){for(var i in obj)if(typeof obj[i]==="object"&&typeof other[i]==="object"){if(JSON.stringify(obj[i])!==JSON.stringify(other[i]))return false}else if(obj[i]!==other[i])return false;return true},loading:function(instance){if(!instance.element.parentNode.querySelector("#ccm_keyframe")){var style=document.createElement("style");style.id="ccm_keyframe";style.appendChild(document.createTextNode("@keyframes ccm_loading { to { transform: rotate(360deg); } }"));instance.element.parentNode.appendChild(style)}return self.helper.html({"class":"ccm_loading",inner:{style:"display: inline-block; width: 0.5em; height: 0.5em; border: 0.15em solid #009ee0; border-right-color: transparent; border-radius: 50%; animation: ccm_loading 1s linear infinite;"}})},makeIterable:function(array_like){return Array.prototype.slice.call(array_like)},onFinish:function(instance,results){if(!instance.onfinish)return;if(typeof instance.onfinish==="function")return instance.onfinish(instance,results);if(typeof instance.onfinish==="string")return this.executeByName(instance.onfinish,[instance,results]);if(instance.onfinish.user)instance.onfinish.user.login(proceed);else proceed();function proceed(){if(instance.onfinish.key&&!results.key)results.key=instance.onfinish.key;if(instance.onfinish.store_settings){var dataset=self.helper.clone(results);if(instance.onfinish.permissions)dataset._=instance.onfinish.permissions;if(instance.onfinish.user&&instance.onfinish.user_specific)dataset.key=[dataset.key||self.helper.generateKey(),instance.onfinish.user.data().key];self.set(instance.onfinish.store_settings,dataset,function(result){var url=instance.onfinish.embed_code_url?'<script src="'+instance.onfinish.embed_code_url+'"></script>':"";if(instance.onfinish.embed_code)alert(url+"<ccm-"+instance.onfinish.embed_code+' key=\'["ccm.get",'+JSON.stringify(instance.onfinish.store_settings)+',"'+result.key+"\"]'></ccm-"+instance.onfinish.embed_code+">");proceed()})}else proceed();function proceed(){if(instance.onfinish.clear)instance.element.innerHTML="";if(instance.onfinish.restart)instance.start(proceed);else proceed();function proceed(){if(instance.onfinish.log)console.log(results);if(instance.onfinish.render){if(instance.onfinish.render.component){var config=instance.onfinish.render.config;if(!config)config={};config.element=instance.element;self.start(instance.onfinish.render.component,config)}else self.helper.setContent(instance.element,self.helper.html(instance.onfinish.render))}if(instance.onfinish.callback)instance.onfinish.callback(instance,results)}}}},prepend:function(parent,node){node=self.helper.protect(node);if(parent.hasChildNodes())parent.insertBefore(node,parent.firstChild);else parent.appendChild(node)},privatize:function(instance,properties){var obj={};if(properties)for(var i=1;i<arguments.length;i++)privatizeProperty(arguments[i]);else for(var key in instance)privatizeProperty(key);return obj;function privatizeProperty(key){switch(key){case"ccm":case"component":case"element":case"id":case"index":case"onfinish":case"parent":case"root":break;default:if(self.helper.isInstance(instance[key])&&instance[key].parent&&instance[key].parent.index===instance.index)return;if(typeof instance[key]==="function")return;if(instance[key]!==undefined)obj[key]=instance[key];delete instance[key]}}},protect:function(value){if(typeof value==="string"){var tag=document.createElement("div");tag.innerHTML=value;self.helper.makeIterable(tag.getElementsByTagName("script")).map(function(script){script.parentNode.removeChild(script)});return tag.innerHTML}if(self.helper.isElementNode(value))self.helper.makeIterable(value.getElementsByTagName("script")).map(function(script){script.parentNode.removeChild(script)});else if(typeof value==="object"&&!self.helper.isNode(value))for(var key in value)value[key]=self.helper.protect(value[key]);return value},regex:function(index){switch(index){case"filename":return/^ccm\.([a-z][a-z0-9_]*)(-(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*))?(\.min)?(\.js)$/;case"key":return/^[a-zA-Z_0-9]+$/}},removeElement:function(element){if(element.parentNode)element.parentNode.removeChild(element)},setContent:function(element,content){content=self.helper.protect(content);if(typeof content==="object"){element.innerHTML="";if(Array.isArray(content))content.map(function(node){element.appendChild(node)});else element.appendChild(content)}else element.innerHTML=content},show:function(instance){instance.element.parentNode.removeChild(instance.element.parentNode.querySelector(".ccm_loading"));instance.element.style.display="block"},shuffleArray:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array},solveDependency:function(obj,key,callback){if(!self.helper.isDependency(obj[key])){if(callback)callback();return}obj[key][0]=self[obj[key][0].split(".").pop()];obj[key].push(function(result){obj[key]=result;if(callback)callback(result)});return self.helper.action(obj[key])},transformStringArray:function(arr){var obj={};arr.map(function(value){obj[value]=true});return obj},wait:function(time,callback){window.setTimeout(callback,time)}}};if(!ccm[self.version()])ccm[self.version()]=self;if(!ccm.version||self.helper.compareVersions(self.version(),ccm.version())>0){ccm.latest=self;self.helper.integrate(self,ccm)}function getSource(settings){var source=JSON.stringify(self.helper.filterProperties(settings,"url","db","store"));if(source==="{}")source=Object.keys(stores).length;return source}})();