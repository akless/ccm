if(!window.jQuery)document.write('<script src="http://code.jquery.com/jquery-latest.min.js"><\/script>');var ccm=function(){var url="http://www.fh-lsoopjava.de/ccm/components/";var db;var Datastore=function(){var self=this;this.get=function(key,callback){if(self.store)return clientDB();if(self.url)return serverDB();if(self.local)return getLocal(key,callback);function clientDB(){var dataset=checkLocal();if(dataset)return dataset;var store=getStore();var request=store.get(key);request.onsuccess=function(evt){var dataset=evt.target.result;if(dataset.key!==undefined)self.local[key]=dataset;if(callback)callback(dataset)}}function serverDB(){var dataset=checkLocal();if(dataset)return dataset;ccm.load(self.url,{key:key},function(dataset){if(dataset.key!==undefined)self.local[key]=dataset;callback(dataset)})}function checkLocal(){var dataset=getLocal(key);if(dataset){if(callback)callback(dataset)}return dataset}};this.set=function(priodata,callback){if(self.store)return clientDB();if(self.url)return serverDB();if(self.local)return setLocal();function setLocal(){if(self.local[priodata.key])ccm.helper.integrate(priodata,self.local[priodata.key]);else self.local[priodata.key]=priodata;return getLocal(priodata.key,callback)}function clientDB(){var store=getStore();var request=store.put(priodata);request.onsuccess=function(){setLocal()}}function serverDB(){ccm.load(self.url,{dataset:priodata},function(dataset){if(dataset.key!==undefined)setLocal()})}};this.del=function(key,callback){if(self.store)return clientDB();if(self.url)return serverDB();if(self.local)return delLocal();function delLocal(){var dataset=self.local[key];delete self.local[key];if(callback)callback(dataset);return dataset}function clientDB(){var store=getStore();var request=store.delete(key);request.onsuccess=function(){delLocal()}}function serverDB(){ccm.load(self.url,{del:key},function(dataset){if(dataset.key!==undefined)delLocal()})}};function getLocal(key,callback){var dataset=ccm.helper.clone(self.local[key]);if(callback)callback(dataset);return dataset}function getStore(){var trans=db.transaction([self.store],"readwrite");return trans.objectStore(self.store)}};return{components:{},datastores:[],callback:{},load:function(resources,data,callback){if(typeof resources==="string")resources=[resources];if(typeof data==="function"){callback=data;data=undefined}var counter=0;var results=new Array(resources.length);for(var i=0;i<resources.length;i++)loadResource(resources[i],i);function loadResource(resource,i){var path=resource.indexOf("/")===-1?url+resource+".js":resource;var suffix=path.split(".").pop();results[i]=path;if(suffix==="css")return loadCSS(path);switch(suffix){case"png":case"jpg":case"gif":return loadImage(path)}counter++;if(suffix==="js")return loadJS(path,successJS);if(suffix==="json"&&path.indexOf("http")===0)return loadJSON(path,successData);exchangeData(path,data,successData);function loadCSS(url){jQuery("head").append('<link rel="stylesheet" type="text/css" href="'+url+'">')}function loadImage(url){jQuery('<img src="'+url+'">')}function loadJS(url,callback){jQuery.getScript(url,callback).fail(onFail)}function loadJSON(url,callback){jQuery("head").append('<script src="'+url+'"><\/script>');var filename=url.split("/").pop();ccm.callback[filename]=callback}function exchangeData(url,data,callback){if(url.indexOf("http")===0){jQuery.ajax({url:url,data:data,dataType:"jsonp",success:callback})}else jQuery.getJSON(url,data,callback).fail(onFail)}function successJS(){var index=filterIndex(path);var component=ccm.components[index];if(!component){delete ccm.components[index];return success()}results[i]=ccm.components[index];component.instances=[];component.index=index;component.create=function(config,callback){return ccm.create(index,config,callback)};if(!component.config)component.config={};if(!component.config.element)component.config.element=jQuery("body");if(!component.config.autostart)component.config.autostart=true;if(component.init)component.init();success()}function successData(data){if(data!==undefined)results[i]=data;success()}function success(){counter--;if(counter===0){if(results.length===1)results=results[0];if(callback)callback(results)}}function onFail(jqxhr,textStatus,error){jQuery("body").html(jqxhr.responseText+"<p>Request Failed: "+textStatus+", "+error+"</p>")}}},create:function(component,config,callback){if(typeof config==="function"){callback=config;config=undefined}return typeof component==="string"?createInstance(component,config):createDatastore(component);function createInstance(component,config){var counter=0;var result;var waiter=[];return recursive(component,config);function recursive(component,config,upper_config,upper_key){var index=filterIndex(component);if(ccm.components[index]===null){waiter.push([recursive,component,config,upper_config,upper_key]);return null}counter++;return!ccm.components[index]?ccm.load(component,proceed):proceed();function proceed(){var instance=new ccm.components[index].Instance;ccm.components[index].instances.push(instance);if(upper_config&&upper_key)upper_config[upper_key]=instance;if(!result)result=instance;instance.id=ccm.components[index].instances.length;instance.index=index+"-"+instance.id;instance.component=ccm.components[index];ccm.helper.integrate(ccm.components[index].config,instance);if(config)ccm.helper.integrate(config,instance);solveDependencies(instance);counter--;return check();function solveDependencies(instance){for(var key in instance){if(isDependency(instance,key))solveDependency(instance,key)}function isDependency(instance,key){if(jQuery.isArray(instance[key]))if(instance[key].length>0)if(typeof instance[key][0]==="function")return true;return false}function solveDependency(instance,key){var action=instance[key];if(action[0]===ccm.create){if(typeof action[1]!=="object")recursive(action[1],action[2],instance,key);else{counter++;ccm.create(action[1],finish)}}if(action[0]===ccm.load){if(action[1].indexOf(".css")===-1)counter++;ccm.load(action[1],action[2],finish)}function finish(result){counter--;instance[key]=result;check()}}}function check(){if(counter===0){if(waiter.length>0)return ccm.helper.action(waiter.shift());initialize(result);if(callback)callback(result)}return counter===0?result:null}function initialize(instance){if(instance.init)instance.init();for(var key in instance)if(instance[key]==="object")if(instance[key].component)initialize(instance[key]);if(instance.start&&instance.autostart)instance.start()}}}}function createDatastore(settings){if(!settings)settings={};if(!settings.local)settings.local={};return typeof settings.local==="string"?ccm.load(settings.local,proceed):proceed(settings.local);function proceed(data){settings.local=data;return settings.store?prepareDB(proceed):proceed();function prepareDB(callback){!db?openDB(proceed):proceed();function openDB(callback){var request=indexedDB.open("ccm");request.onsuccess=function(){db=this.result;callback()}}function proceed(){!db.objectStoreNames.contains(settings.store)?updateDB(callback):callback();function updateDB(callback){var version=parseInt(localStorage.getItem("ccm"));if(!version)version=1;db.close();var request=indexedDB.open("ccm",version+1);request.onupgradeneeded=function(){db=this.result;localStorage.setItem("ccm",db.version);db.createObjectStore(settings.store,{keyPath:"key"})};request.onsuccess=callback}}}function proceed(){var datastore=new Datastore;ccm.helper.integrate(settings,datastore);ccm.datastores.push(datastore);if(callback)callback(datastore);return datastore}}}},helper:{action:function(action,context){if(typeof action==="function"){return action()}if(typeof action!=="object"){action=action.split(" ")}if(typeof action[0]==="function")return action[0].apply(window,action.slice(1));else if(action[0].indexOf("this.")===0)return this.executeByName(action[0].substr(5),action.slice(1),context);else return this.executeByName(action[0],action.slice(1))},clone:function(obj,flat){return typeof obj==="object"?jQuery.extend(!flat,{},obj):undefined},evaluateForm:function(form){form.find("input[type=checkbox]").each(function(){var checkbox=jQuery(this);if(!checkbox.is(":checked")){checkbox.attr("data-input",checkbox.attr("value"));checkbox.attr("value","")}checkbox.prop("checked",true)});var data=form.serializeArray();form.find('input[type=checkbox][value=""]').each(function(){var checkbox=jQuery(this);checkbox.prop("checked",false);checkbox.attr("value",checkbox.attr("data-input"));checkbox.removeAttr("data-input")});var result={};for(var i=0;i<data.length;i++)result[data[i]["name"]]=data[i]["value"];return result},executeByName:function(functionName,args,context){if(!context)context=window;var namespaces=functionName.split(".");functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[functionName].apply(context,args)},filter:function(priodata,dataset){priodata=ccm.helper.clone(priodata);for(var i in priodata)if(priodata[i]===dataset[i])delete priodata[i]},integrate:function(priodata,dataset){if(!priodata){return dataset}if(!dataset){return priodata}for(var i in priodata){if(priodata[i]!==undefined)dataset[i]=priodata[i];else delete dataset[i]}return dataset},reselect:function(instance){if(instance.element)instance.element=jQuery(instance.element.selector)},tag:function(dataset){if(jQuery.isArray(dataset)){var result=[];for(var j=0;j<dataset.length;j++)result.push(ccm.helper.tag(dataset[j]));return result}var element=jQuery("<"+dataset.tag+">");for(var key in dataset){var value=dataset[key];switch(key){case"action":case"type":case"name":case"value":case"pattern":case"title":case"for":case"id":case"class":element.attr(key,value);break;case"checked":case"selected":case"required":element.prop(key,true);break;case"content":if(typeof value==="string")element.html(value);if(jQuery.isPlainObject(value))element.append(this.tag(value));if(jQuery.isArray(value))for(var i=0;i<value.length;i++)element.append(this.tag(value[i]));break;case"onClick":element.click(value);break;case"onChange":element.change(value);break;case"onSubmit":element.submit(value);break;default:if(key.indexOf("data-")===0)element.attr(key,value)}}return element},tagExists:function(element){return element.closest("html").length>0},wait:function(time,callback){window.setTimeout(callback,time)}}};function filterIndex(path){return path.split("/").pop().split(".")[0]}}();