(function(){var remote=true;var domain=remote?"https://kaul.inf.h-brs.de/ccm/":"";var p=remote?"p":"";if(!window.jQuery){if(document.body){window.jQuery=document.createElement("script");window.jQuery.setAttribute("src",remote?"https://code.jquery.com/jquery-2.1.4.min.js":"lib/jquery.min.js");document.head.appendChild(window.jQuery)}else document.write('<script src="'+(remote?"https://code.jquery.com/jquery-2.1.4.min.js":"lib/jquery.min.js")+'"></script>')}ccm=function(){var components={};var db;var resources={};var stores={};var waiter={};var Datastore=function(){var callbacks=[];var self=this;this.init=function(){if(self.socket)self.socket.onmessage=function(message){message=JSON.parse(message.data);if(message.callback)callbacks[message.callback-1](message.data);else{var dataset=jQuery.isPlainObject(message)?setLocal(message):delLocal(message);if(self.onChange)self.onChange(dataset,message)}}};this.get=function(key,callback,user,password){if(typeof key==="function"){password=user;user=callback;callback=key;key={}}if(key===undefined)key={};if(self.url)return serverDB();if(self.store)return clientDB();if(self.local)return localCache();function localCache(){return getLocal(key,callback)}function clientDB(){var dataset=checkLocal();if(dataset)return dataset;var store=getStore();var request=store.get(key);request.onsuccess=function(evt){var dataset=evt.target.result;if(!dataset)return callback(null);if(dataset.key!==undefined)self.local[key]=dataset;if(callback)callback(dataset)}}function serverDB(){if(!jQuery.isPlainObject(key)){var dataset=checkLocal();if(dataset)return dataset}var data=prepareData({key:key},user,password);if(self.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(results){if(!checkResponse(results,user))return;if(!results)return callback(null);if(ccm.helper.isDataset(results))self.local[results.key]=results;else for(var i=0;i<results.length;i++)if(results[i].key!==undefined)self.local[results[i].key]=results[i];callback(results)}}function checkLocal(){var dataset=getLocal(key);if(dataset&&callback)callback(dataset);return dataset}};this.set=function(priodata,callback,user,password){if(!priodata.key)priodata.key=ccm.helper.generateKey();if(self.url)return serverDB();if(self.store)return clientDB();if(self.local)return localCache();function localCache(){return setLocal(priodata,callback)}function clientDB(){var store=getStore();var request=store.put(priodata);request.onsuccess=localCache}function serverDB(){var data=prepareData({dataset:priodata},user,password);if(self.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(dataset){if(!checkResponse(dataset,user))return;priodata=dataset;localCache()}}};this.del=function(key,callback,user,password){if(self.url)return serverDB();if(self.store)return clientDB();if(self.local)return localCache();function localCache(){return delLocal(key,callback)}function clientDB(){var store=getStore();var request=store.delete(key);request.onsuccess=localCache}function serverDB(){var data=prepareData({del:key},user,password);if(self.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);function onResponse(dataset){if(!checkResponse(dataset,user))return;if(callback)callback(dataset);callback=undefined;localCache()}}};this.count=function(callback,user,password){if(self.url)return serverDB();if(self.store)return clientDB();if(self.local)return localCache();function localCache(){var count=Object.keys(self.local).length;if(callback)callback(count);return count}function clientDB(){if(!callback)return-1;var store=getStore();var request=store.count();request.onsuccess=function(){callback(request.result)};return-1}function serverDB(){if(!callback)return-1;var data=prepareData({count:true},user,password);if(self.socket)useWebsocket(data,onResponse);else useHttp(data,onResponse);return-1;function onResponse(count){if(!checkResponse(count,user))return;if(callback)callback(count)}}};this.clear=function(){self.local={}};function getLocal(key,callback){if(key===undefined||jQuery.isPlainObject(key))return find();var dataset=self.local[key]?ccm.helper.clone(self.local[key]):null;solveDependencies(dataset,callback);return dataset;function find(){var results=[];var counter=1;for(var i in self.local){if(ccm.helper.isSubset(key,self.local[i])){var dataset=ccm.helper.clone(self.local[i]);results.push(dataset);counter++;solveDependencies(dataset,check)}}check();return results;function check(){counter--;if(counter===0&&callback)callback(results)}}function solveDependencies(dataset,callback){var counter=1;var waiter=[];for(var key in dataset){var value=dataset[key];if(ccm.helper.isDependency(value))solveDependency(dataset,key);else if(jQuery.isArray(value))for(var i=0;i<value.length;i++)if(ccm.helper.isDependency(value[i]))solveDependency(value,i)}check();function solveDependency(dataset,key){if(stores[getSource(dataset[key][1])]===null)return waiter.push([solveDependency,dataset,key]);counter++;ccm.helper.solveDependency(dataset,key,check)}function check(){counter--;if(counter!==0)return;if(waiter.length>0)return ccm.helper.action(waiter.pop());if(callback)callback(dataset)}}}function setLocal(priodata,callback){if(self.local[priodata.key])ccm.helper.integrate(priodata,self.local[priodata.key]);else self.local[priodata.key]=priodata;return getLocal(priodata.key,callback)}function delLocal(key,callback){var dataset;if(key===undefined){dataset=self.local;self.local={}}else{dataset=self.local[key];delete self.local[key]}if(callback)callback(dataset);return dataset}function getStore(){var trans=db.transaction([self.store],"readwrite");return trans.objectStore(self.store)}function prepareData(data,user,password){user=user||self.user;return ccm.helper.integrate(data,{db:self.db,store:self.store,username:ccm.helper.isInstance(user)?user.key:user,password:password||self.password})}function useWebsocket(data,callback){callbacks.push(callback);data.callback=callbacks.length;self.socket.send(JSON.stringify(data))}function useHttp(data,callback){ccm.load([self.url,data],callback)}function checkResponse(response,user){if(typeof response==="string"&&response.indexOf("[ccm]")===0){if(ccm.helper.isInstance(user))user.logout();return false}return true}};return{callback:{},loading_icon:domain+"img/ccm-load-icon.gif",version:[4,1,0],load:function(){var counter=1;var results=[];var args=Array.prototype.slice.call(arguments);var call=args.slice(0);call.unshift(ccm.load);var waiting=false;var callback;if(typeof args[args.length-1]==="function"||args[args.length-1]===undefined)callback=args.pop();for(var i=0;i<args.length;i++)loadResource(args[i],i);return check();function loadResource(url,i){var data;if(jQuery.isArray(url)){data=url[1];url=url[0]}var resource=resources[url];resources[url]=null;counter++;if(data)return exchangeData();var suffix=url.split(".").pop();switch(suffix){case"html":return loadHTML();case"css":return loadCSS();case"jpg":case"gif":case"png":case"svg":return loadImage();case"js":return loadJS();case"json":return loadJSON();default:exchangeData()}function loadHTML(){if(caching())return;if(url.indexOf("http")!==0)return jQuery.ajax({url:url,cache:false,success:successData});var filename=url.split("/").pop();ccm.callback[filename]=successData;jQuery("head").append('<script src="'+url+'"></script>')}function loadCSS(){if(!resource)jQuery("head").append('<link rel="stylesheet" type="text/css" href="'+url+'">');success()}function loadImage(){if(!resource)jQuery('<img src="'+url+'">');success()}function loadJS(){if(caching())return;jQuery.getScript(url,successJS).fail(onFail)}function loadJSON(){if(caching())return;if(url.indexOf("http")!==0)return jQuery.getJSON(url,successData).fail(onFail);var filename=url.split("/").pop();ccm.callback[filename]=successData;jQuery("head").append('<script src="'+url+'"></script>')}function exchangeData(){if(waiting)return;if(url.indexOf("http")===0){jQuery.ajax({url:url,data:data,dataType:"jsonp",username:data&&data.username?data.username:undefined,password:data&&data.password?data.password:undefined,success:successData})}else{jQuery.ajax({url:url,data:data,username:data&&data.username?data.username:undefined,password:data&&data.password?data.password:undefined,success:successData}).fail(onFail)}}function caching(){if(resource===null){if(waiting)return true;else waiting=true;if(!waiter[url])waiter[url]=[];waiter[url].push(call);return true}if(resource){results[i]=resources[url]=resource;success();return true}return false}function successJS(){var index=getIndex(url);var component=components[index];if(!component)return success();results[i]=resources[url]=component;while(waiter[component.index]&&waiter[component.index].length>0)ccm.helper.action(waiter[component.index].pop());success()}function successData(data){results[i]=resources[url]=data;success()}function success(){if(!resources[url])resources[url]=url;while(waiter[url]&&waiter[url].length>0)ccm.helper.action(waiter[url].pop());check()}function onFail(jqxhr,textStatus,error){console.log(jqxhr,this.url);jQuery("body").html(jqxhr.responseText+"<p>Request Failed: "+textStatus+", "+error+"</p>")}}function check(){counter--;if(counter===0){if(results.length<=1)results=results[0];if(callback)callback(results);return results}}},register:function(component,callback){if(typeof component==="string")return ccm.load(component,callback);setIndex();if(components[component.index])return components[component.index];setup();components[component.index]=component;if(component.init)component.init(proceed);else proceed();function proceed(){if(callback)callback(component)}function setIndex(){if(component.index){var array=component.index.split("-");component.name=array[0];if(array.length>1)component.version=array[1].split(".");for(var i=0;i<3;i++)component.version[i]=parseInt(component.version[i])}component.index=component.name;if(component.version)component.index+="-"+component.version.join(".")}function setup(){component.instances=0;component.instance=function(config,callback){return ccm.instance(component.index,config,callback)};component.render=function(config,callback){return ccm.render(component.index,config,callback)};if(!component.config)component.config={};if(!component.config.element)component.config.element=jQuery("body")}},instance:function(component,config,callback){if(typeof config==="function"){callback=config;config=undefined}var counter=0;var result;return recursive(component,config);function recursive(comp,cfg,prev_cfg,prev_key,parent){var index=getIndex(comp);counter++;return!components[index]?ccm.load(comp,proceed):proceed();function proceed(){return ccm.helper.isDependency(cfg)?ccm.dataset(cfg[1],cfg[2],proceed):proceed(cfg);function proceed(cfg){var instance=new components[index].Instance;components[index].instances++;if(prev_cfg)prev_cfg[prev_key]=instance;if(parent)instance.parent=parent;if(!result)result=instance;instance.id=components[index].instances;instance.index=index+"-"+instance.id;instance.component=components[index];ccm.helper.integrate(components[index].config,instance);if(cfg)ccm.helper.integrate(cfg,instance);switch(instance.element){case"index":instance.element=parent.element.find("."+instance.component.name+":not(#ccm-"+parent.index+" .ccm *)");break;case"parent":instance.element=parent.element}solveDependencies(instance);return check();function solveDependencies(instance_or_array){for(var key in instance_or_array){var value=instance_or_array[key];if(ccm.helper.isDependency(value))solveDependency(instance_or_array,key);else if(typeof value==="object"&&value!==null){if(value instanceof jQuery||value.component||value.Instance)continue;solveDependencies(value)}}function solveDependency(instance_or_array,key){var action=instance_or_array[key];switch(action[0]){case ccm.load:case"ccm.load":counter++;ccm.load(action[1],setResult);break;case ccm.register:case"ccm.register":counter++;ccm.register(action[1],setResult);break;case ccm.instance:case"ccm.instance":recursive(action[1],action[2],instance_or_array,key,instance);break;case ccm.proxy:case"ccm.proxy":proxy(action[1],action[2],instance_or_array,key,instance);break;case ccm.store:case"ccm.store":counter++;ccm.store(action[1],setResult);break;case ccm.dataset:case"ccm.dataset":counter++;ccm.dataset(action[1],action[2],setResult);break}function setResult(result){instance_or_array[key]=result;check()}function proxy(component,config,instance_or_array,key,parent){ccm.helper.isDependency(config)?ccm.dataset(config[1],config[2],proceed):proceed(config);function proceed(config){instance_or_array[key]={component:component,parent:parent,render:function(callback){delete this.component;delete this.initialized;delete this.render;if(!config)config={};ccm.helper.integrate(this,config);ccm.render(component,config,function(instance){instance_or_array[key]=instance;if(callback)callback()})}}}}}}function check(){counter--;if(counter===0){initialize(result,function(){if(callback)callback(result)})}return counter===0?result:null}function initialize(instance,callback){var counter=1;init(instance);function init(instance){if(instance.init&&!instance.initialized){if(ccm.helper.isInstance(instance))counter++;instance.init(function(){if(ccm.helper.isInstance(instance)){instance.initialized=true;delete instance.init}proceed();if(ccm.helper.isInstance(instance))check()})}else proceed();check();function proceed(){for(var key in instance){var value=instance[key];if(ccm.helper.isInstance(value)&&key!=="parent")init(value);else if(typeof value==="object"&&value!==null){if(value instanceof jQuery||value.component||value.Instance)continue;init(value)}}}function check(){counter--;if(counter!==0)return;if(callback)callback()}}}}}}},render:function(component,config,callback){ccm.instance(component,config,function(instance){instance.render(function(){if(callback)callback(instance)})})},store:function(settings,callback){if(typeof settings==="function"){callback=settings;settings=undefined}if(!settings)settings={};if(typeof settings==="string")settings={local:settings};settings=ccm.helper.clone(settings);var source=getSource(settings);if(stores[source]){if(callback)callback(stores[source]);return stores[source]}if(!settings.local)settings.local={};return typeof settings.local==="string"?ccm.load(settings.local,proceed):proceed(settings.local);function proceed(datasets){settings.local=datasets;return settings.store&&!settings.url?prepareDB(proceed):proceed();function prepareDB(callback){!db?openDB(proceed):proceed();function openDB(callback){var request=indexedDB.open("ccm");request.onsuccess=function(){db=this.result;callback()}}function proceed(){!db.objectStoreNames.contains(settings.store)?updateDB(callback):callback();function updateDB(callback){var version=parseInt(localStorage.getItem("ccm"));if(!version)version=1;db.close();var request=indexedDB.open("ccm",version+1);request.onupgradeneeded=function(){db=this.result;localStorage.setItem("ccm",db.version);db.createObjectStore(settings.store,{keyPath:"key"})};request.onsuccess=callback}}}function proceed(){var store=new Datastore;ccm.helper.integrate(settings,store);if(store.url&&store.url.indexOf("ws")===0){store.socket=new WebSocket(store.url,"ccm");store.socket.onopen=function(){this.send([store.db,store.store]);proceed()}}else return proceed();function proceed(){store.init();stores[source]=store;if(callback)callback(store);return store}}}},dataset:function(settings,key,callback,user,password){ccm.store(settings,function(store){store.get(key,callback,user,password)})},context:{find:function(instance,property){var result;do if(instance[property])result=instance[property];while(instance=instance.parent);return result},root:function(instance){while(instance.parent)instance=instance.parent;return instance},user:function(instance){return ccm.context.find(instance,"user")}},helper:{action:function(action,context){if(typeof action==="function")return action();if(typeof action!=="object"){action=action.split(" ")}if(typeof action[0]==="function")return action[0].apply(window,action.slice(1));else if(action[0].indexOf("this.")===0)return this.executeByName(action[0].substr(5),action.slice(1),context);else return this.executeByName(action[0],action.slice(1))},clone:function(obj,flat){return typeof obj==="object"?jQuery.extend(!flat,{},obj):undefined},element:function(instance){ccm.helper.reselect(instance);var name=instance.component.name;if(jQuery.isArray(instance.classes))instance.classes=instance.classes.join(" ");instance.element.html('<div id="ccm-'+instance.index+'" class="ccm '+(instance.classes?instance.classes:"ccm-"+name)+'"></div>');var element=instance.element.find("#ccm-"+instance.index);ccm.helper.loading(element);return element},executeByName:function(functionName,args,context){if(!context)context=window;var namespaces=functionName.split(".");functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[functionName].apply(context,args)},filter:function(priodata,dataset){priodata=ccm.helper.clone(priodata);for(var i in priodata)if(priodata[i]===dataset[i])delete priodata[i]},focusInput:function(input,position){input=input.get(0);if(position===undefined)position=input.value.length;input.selectionStart=input.selectionEnd=position;input.focus()},format:function(string,values){var functions=[[],[]];string=JSON.stringify(string,function(key,val){if(typeof val==="function"){functions[0].push(val);return"%f0"}return val});for(var i=1;i<arguments.length;i++){if(typeof arguments[i]==="function"){functions[1].push(arguments[i]);arguments[i]="%f1"}if(typeof arguments[i]==="object")for(var key in arguments[i])string=string.replace(new RegExp("%"+key,"g"),arguments[i][key]);else string=string.replace(/%s/,arguments[i])}return JSON.parse(string,function(key,val){if(val==="%f0")return functions[0].shift();if(val==="%f1")return functions[1].shift();return val})},formData:function(form){form.find("input[type=checkbox]").each(function(){var checkbox=jQuery(this);if(!checkbox.is(":checked")){checkbox.attr("data-input",checkbox.attr("value"));checkbox.attr("value","")}checkbox.prop("checked",true)});var data=form.serializeArray();form.find('input[type=checkbox][value=""]').each(function(){var checkbox=jQuery(this);checkbox.prop("checked",false);checkbox.attr("value",checkbox.attr("data-input"));checkbox.removeAttr("data-input")});var result={};for(var i=0;i<data.length;i++)result[data[i]["name"]]=data[i]["value"];return result},generateKey:function(){return Date.now()+"X"+Math.random().toString().substr(2)},html:function(html,values){if(arguments.length>1)html=ccm.helper.format.apply(this,arguments);if(jQuery.isArray(html)){var result=[];for(var i=0;i<html.length;i++)result.push(ccm.helper.html(html[i]));return result}if(typeof html==="string")html=ccm.helper.val(html);if(typeof html!=="object")return html;var element=jQuery("<"+ccm.helper.val(html.tag||"div","tag")+">");delete html.tag;for(var key in html){var value=html[key];switch(key){case"checked":case"disabled":case"readonly":case"required":case"selected":if(value&&value!=="undefined"&&value!=="false")element.prop(key,true);break;case"inner":element.html(this.html(value));break;case"onchange":element.change(value);break;case"onclick":element.click(value);break;case"oninput":element.on("input",value);break;case"onmouseenter":element.mouseenter(value);break;case"onsubmit":element.submit(value);break;default:element.attr(key,ccm.helper.val(value))}}return element},htmlEncode:function(value,trim,quot){if(typeof value!=="string")value=value.toString();value=trim||trim===undefined?value.trim():value;value=jQuery("<div>").text(value).html();value=quot||quot===undefined?value.replace(/"/g,"&quot;"):value;return value},htmlDecode:function(value){return jQuery("<div>").html(value).text()},dataset:function(self,callback){self.store.get(self.key,function(dataset){if(dataset===null)self.store.set({key:self.key},proceed);else proceed(dataset);function proceed(dataset){self.key=dataset.key;if(callback)callback(dataset)}})},integrate:function(priodata,dataset){if(!priodata){return dataset}if(!dataset){return priodata}for(var i in priodata){if(priodata[i]!==undefined)dataset[i]=priodata[i];else delete dataset[i]}return dataset},isComponent:function(value){return typeof value==="object"&&value!==null&&value.Instance},isDataset:function(value){return typeof value==="object"&&!jQuery.isArray(value)&&value!==null},isDependency:function(value){if(jQuery.isArray(value))if(value.length>0)switch(value[0]){case ccm.load:case"ccm.load":case ccm.register:case"ccm.register":case ccm.instance:case"ccm.instance":case ccm.proxy:case"ccm.proxy":case ccm.render:case"ccm.render":case ccm.store:case"ccm.store":case ccm.dataset:case"ccm.dataset":return true}return false},isInstance:function(value){return typeof value==="object"&&value!==null&&value.component&&true},isSubset:function(obj,other){for(var i in obj)if(typeof obj[i]==="object"&&typeof other[i]==="object"){if(JSON.stringify(obj[i])!==JSON.stringify(other[i]))return false}else if(obj[i]!==other[i])return false;return true},loading:function(element){(element?element:jQuery("body")).html('<img src="'+ccm.loading_icon+'">');function renderNoImageIcon(){document.write("<style>@keyframes ccm-loading { 0%{ opacity: 1; } 100% { opacity : 0; } }</style>");var loading=jQuery('<div class="ccm-loading">'+'<div class="bar-1"></div>'+'<div class="bar-2"></div>'+'<div class="bar-3"></div>'+'<div class="bar-4"></div>'+'<div class="bar-5"></div>'+'<div class="bar-6"></div>'+'<div class="bar-7"></div>'+'<div class="bar-8"></div>'+'<div class="bar-9"></div>'+'<div class="bar-10"></div>'+'<div class="bar-11"></div>'+'<div class="bar-12"></div>'+'<div class="bar-13"></div>'+'<div class="bar-14"></div>'+'<div class="bar-15"></div>'+'<div class="bar-16"></div>'+"</div>");var i=0;loading.css({position:"relative",width:"35px",height:"35px",left:"15px",top:"12px"}).find("div").css({position:"absolute",width:"2px",height:"8px","background-color":"#25363F",opacity:"0.05",animation:"ccm-loading 0.8s linear infinite"}).each(function(){jQuery(this).css({transform:"rotate("+i*22.5+"deg) translate( 0, -12px )","animation-delay":.05+i*.05+"s"});i++});element.html(loading)}},noScript:function(value){var div=jQuery("<div>").html(value);div.find("script").remove();return div.html()},regex:function(index){switch(index){case"key":return/^[a-z_0-9][a-zA-Z_0-9]*$/;case"tag":return/^[a-z][a-zA-Z]*$/;case"url":return/^(((http|ftp|https):\/\/)?[\w-]+(\.[\w-]*)+)?([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?$/}},reselect:function(instance){if(instance.element)instance.element=jQuery(instance.element.selector)},solveDependency:function(obj,key,callback){obj[key].push(function(result){obj[key]=result;callback(result)});return ccm.helper.action(obj[key])},tagExists:function(element){return element.closest("html").length>0},val:function(string,regex){if(!regex)return ccm.helper.noScript(string);if(regex===true)return ccm.helper.htmlEncode(string);return(typeof regex==="string"?ccm.helper.regex(regex):regex).test(string)?string:null},wait:function(time,callback){window.setTimeout(callback,time)}}};function getIndex(url){if(url.indexOf(".js")===-1)return url;var filename=url.split("/").pop();return filename.substr(0,filename.lastIndexOf("."))}function getSource(settings){var source=JSON.stringify(settings);if(source==="{}")source=Object.keys(stores).length;return source}}()})();